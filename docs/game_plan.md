# 게임 개발 계획서: 던전 앤 디스코드 (v2.0)

**문서 목적**: 이 문서는 `던전 앤 디스코드` 게임 개발의 전체적인 로드맵과 우선순위를 정의합니다. 모든 개발 작업은 이 계획을 기반으로 진행하며, 상세한 게임 디자인 명세는 `docs/game_design_detail.md`를 따릅니다.

---

### 1. 핵심 비전 및 목표

- **비전**: Discord에서 즐기는, 절차적으로 생성된 던전을 탐험하며 매번 새로운 경험을 제공하는 하드코어 텍스트 로그라이크.
- **핵심 목표**: '의미 있는 선택', '버려지는 아이템 없는 디자인', '예측 불가능성이 만드는 서사'라는 3대 디자인 철학을 구현하여, 깊이 있는 전략과 높은 리플레이 가치를 지닌 게임을 완성한다.

---

### 2. 주요 기능 및 시스템 (Features & Systems)

*   **절차적 던전 생성 (Procedural Dungeon Generation)**: 매 플레이마다 새로운 구조의 던전, 몬스터, 아이템 배치를 통해 예측 불가능한 탐험 경험을 제공합니다.
*   **영구적 죽음 (Permadeath)**: 캐릭터의 죽음은 영구적이며, 모든 성장과 아이템이 사라집니다. `/전적` 명령어를 통해 과거의 영광과 실패를 기록합니다.
*   **깊이 있는 캐릭터 빌드 (Deep Character Builds)**:
    *   **종족/직업 시스템**: 고유한 특성과 스킬을 가진 종족과 직업의 조합으로 시너지를 창출하고, 자신만의 플레이 스타일을 구축합니다.
    *   **살아있는 아이템**: 단순 스탯을 넘어, 고유한 사용 효과, 조건부 능력, 저주/축복 등을 통해 새로운 전략의 가능성을 엽니다.
*   **공물-계약 시스템 (Tribute-Covenant System)**: 던전의 미스테리한 '석판'과 상호작용합니다. 초반에는 '공물'을 바쳐 작은 보상과 힌트를 얻고, 준비가 되었을 때 하이 리스크-하이 리턴의 '계약'을 맺어 강력한 권능을 얻거나 끔찍한 반발을 받습니다.
*   **전술적 턴제 상호작용 (Tactical Turn-based Interaction)**: 8방향 이동, 시야(FoV) 시스템, `관찰하기`, `줍기` 등 신중한 판단을 요구하는 턴제 기반의 게임 플레이를 제공합니다.
*   **최적화된 UI/UX (Optimized UI/UX)**:
    *   **뷰포트 렌더링**: 플레이어 중심의 고정된 맵 크기를 코드 블록으로 렌더링하여, 어떤 환경에서도 깨지지 않는 안정적인 시각적 경험을 제공합니다.
    - **100% 이모지 그래픽**: 아스키 문자와의 혼용으로 인한 그리드 깨짐 현상을 원천적으로 방지하고, 시각적 매력을 극대화합니다.
    *   **안정적 상호작용**: 이동 시 '입력 잠금(Input Locking)', 관찰 시 '디바운싱(Debouncing)' 기술을 적용하여 Discord API 제한에 대응하고 쾌적한 플레이를 보장합니다.

---

### 3. 개발 로드맵 (Development Roadmap)

개발은 총 6개의 단계(Phase)로 나누어 진행합니다. 각 단계는 명확한 목표를 가지며, 이전 단계의 완성을 기반으로 합니다.

#### **Phase 0: 기반 구축 및 핵심 렌더링 (Foundation & Core Rendering)**
*   **목표**: 게임의 가장 기본적인 시각적 요소와 상호작용의 뼈대를 완성합니다. 플레이어가 맵을 보고 움직이는 경험을 구현하는 데 집중합니다.
*   **주요 과업**:
    1.  **코어 게임 루프 설계**: 게임 상태(Game State)를 관리하고, 플레이어의 입력을 받아 턴을 진행하는 기본 구조를 설계합니다.
    2.  **뷰포트 렌더러 구현**: `(21x11)` 크기의 맵을 잘라 코드 블록(\`\`\`)과 100% 이모지를 사용해 출력하는 `Viewport Renderer`를 개발합니다.
    3.  **시야(FoV) 시스템 구현**: `시야 내(컬러)`, `기억 속(단색)`, `미탐험(안개)` 영역을 시각적으로 구분하여 렌더링하는 기능을 구현합니다.
    4.  **기본 이동 구현**: Discord 버튼을 이용한 8방향 이동 기능을 구현합니다. 빠른 연타로 인한 오류를 막기 위해 **'입력 잠금(Input Locking)'** 메커니즘을 적용합니다.

#### **Phase 1: 캐릭터 생성 및 세계 구축 (Character & World Generation)**
*   **목표**: 플레이어가 자신만의 캐릭터로 절차적으로 생성된, 여러 층으로 이루어진 세계에 진입하는 과정을 완성합니다.
*   **주요 과업**:
    1.  **DB 스키마 최종 확정**: `(완료)` `player_characters` 테이블에 현재 층을 기록하는 `current_floor` 컬럼이 추가되었습니다.
    2.  **`/탐험시작` 명령어 구현**: `(완료)` 종족/직업 선택 UI를 포함한 캐릭터 생성 및 DB 저장 기능이 구현되었습니다.
    3.  **다층 구조 던전 생성기 구현**: `(신규)`
        - **'방과 복도(Rooms and Corridors)'** 알고리즘 기반의 `Dungeon` 클래스를 `game/dungeon.py`에 구현합니다.
        - 던전 생성 시, 다음 층으로 가는 '아랫 계단(`🔽`)'과 이전 층으로 가는 '윗 계단(`🔼`)'을 논리적인 위치에 배치합니다.
    4.  **GameManager 다층 구조 지원**: `(신규)`
        - `GameManager`가 단일 던전이 아닌, 여러 층의 던전 객체들을 관리하도록 구조를 변경합니다. (`{1: Dungeon_Obj, 2: Dungeon_Obj, ...}` 형태의 **던전 캐싱 시스템**)
        - 플레이어가 계단을 이용할 때, 층을 이동시키고 새로운 맵 정보를 로드/생성하는 **층 이동 로직**을 구현합니다.
    5.  **`/내정보` 명령어 개선**: `(개선)`
        - 현재 뼈대만 있는 `/내정보` 명령어에 플레이어의 스탯, 장비, 인벤토리, 그리고 **현재 위치한 층수**를 시각적으로 보여주는 임베드(Embed) UI를 구현합니다.

#### **Phase 2: 핵심 게임플레이 구현 (Core Gameplay Loop)**
*   **목표**: 던전을 탐험하고, 몬스터와 싸우고, 아이템을 줍는 로그라이크의 가장 기본적인 순환을 완성합니다.
*   **주요 과업**:
    1.  **기본 전투 시스템 구현**: 플레이어와 몬스터가 턴을 주고받으며 싸우는 기초적인 전투 로직을 구현합니다. (공격, 피해 계산, HP 반영)
    2.  **몬스터 배치 및 AI 구현**: 던전 생성 시 몬스터를 배치하고, 플레이어를 향해 다가오는 간단한 AI를 구현합니다.
    3.  **아이템 상호작용 구현**: 던전에 아이템을 배치하고, `줍기` 버튼과 상세 UI를 통해 아이템을 획득하는 기능을 구현합니다.
    4.  **영구적 죽음 구현**: 캐릭터의 HP가 0이 되면 사망 처리하고, `game_character_history` 테이블에 기록을 남기는 '영구적 죽음' 시스템을 적용합니다.
    5.  **`관찰하기` 명령어 구현**: 커서를 움직여 타일의 상세 정보를 보는 기능을 구현합니다. API 요청 최소화를 위해 **'디바운싱(Debouncing)'** 메커니즘을 적용합니다.

#### **Phase 3: 전략의 심화 (Deepening the Strategy)**
*   **목표**: 캐릭터 빌드의 깊이를 더하고, 아이템 사용에 전략적 고민을 추가합니다.
*   **주요 과업**:
    1.  **'살아있는 아이템' 시스템 구현**: 단순 스탯 외에 고유 효과(예: `흡혈의 단검`)를 가진 아이템과, 저주/축복 시스템을 구현합니다.
    2.  **아이템 식별 시스템 구현**: 미확인 아이템을 사용하거나 스크롤을 통해 '식별'하는 과정을 구현합니다.
    3.  **종족/직업 특성 구현**: 각 종족/직업의 고유 패시브 및 액티브 스킬을 구현하고, 캐릭터 스탯에 반영합니다. (예: 엘프의 `마나 친화`, 전사의 `강타`)

#### **Phase 4: 공물-계약 시스템 (The Tribute-Covenant System)**
*   **목표**: 게임의 핵심 차별화 요소인 '공물-계약' 시스템을 완성하여, 플레이어에게 새로운 차원의 선택과 결과를 제공합니다.
*   **주요 과업**:
    1.  **'석판' 오브젝트 구현**: 던전 내에 상호작용 가능한 '석판'을 배치합니다.
    2.  **'공물' 단계 구현**: 석판에 아이템을 바쳐 `공헌도`를 쌓고, 그에 따른 작은 보상/힌트를 제공하는 시스템을 개발합니다.
    3.  **'계약' 단계 구현**: `공헌도`가 특정 수준에 도달했을 때 '계약'을 맺고, 조항에 따라 '권능'과 '반발' 효과를 받는 시스템을 개발합니다.
    4.  **계약 압박 완화 장치 구현**: 계약 효과를 일시적으로 정지시키는 소모성 아이템 `고요의 부적`을 구현합니다.

#### **Phase 5: 다듬기 및 콘텐츠 확장 (Polishing & Content Expansion)**
*   **목표**: 완성된 시스템을 기반으로 게임의 완성도를 높이고, 장기적으로 즐길 수 있는 콘텐츠를 추가합니다.
*   **주요 과업**:
    1.  **`/전적` 기능 완성**: 사망/승리한 캐릭터들의 기록(묘비)을 열람하는 UI를 완성합니다.
    2.  **콘텐츠 대량 추가**: 새로운 종족, 직업, 아이템, 몬스터, 그리고 다양한 테마의 '계약'들을 추가합니다.
    3.  **밸런스 조정**: 게임의 난이도 곡선을 조정하고, 각종 데이터(스탯, 확률 등)를 테스트하며 밸런스를 맞춥니다.
    4.  **UI/UX 개선**: 사용자 피드백을 바탕으로 명령어 설명, 버튼 배치 등 편의성을 개선합니다.

---

### 4. 데이터 및 버전 관리 (Data & Version Management)

*   **원칙**: 코드 버전(Git)과 데이터 버전(DB)을 통합 관리하여, 배포 시 항상 코드와 데이터베이스의 정합성을 보장합니다.
*   **프로세스**: 봇 시작 시, 코드에 정의된 최신 데이터 버전과 DB에 기록된 버전을 비교하여, 차이가 있을 경우 `sql/updates/` 폴더의 스크립트를 순차적으로 자동 실행합니다.

---

### 5. 참고 자료 (References)

*   **상세 게임 디자인**: `docs/game_design_detail.md`
*   **데이터베이스 스키마**: `sql/create_game_tables.sql` 
# 게임 디자인 상세 기획서: 던전 앤 디스코드 (v2.0)

### 1. 컨셉 및 비전 (Concept & Vision)

- **게임명**: 던전 앤 디스코드 (Dungeons & Discord)
- **장르**: 텍스트 기반 클래식 로그라이크 (Text-based Classic Roguelike)
- **핵심 비전**: Discord에서 즐기는, 절차적으로 생성된 던전을 탐험하며 매번 새로운 경험을 제공하는 하드코어 텍스트 로그라이크. 죽음은 영구적이며, 깊은 전략과 신중한 판단을 요구합니다.

### 2. 주요 레퍼런스 (Key References)

- **Dungeon Crawl Stone Soup**: **다양한 신과 그에 따른 권능/징벌 시스템**, 깊이 있는 마법 및 스킬 시스템의 핵심 레퍼런스.
- **NetHack / Angband**: **"모든 것은 상호작용할 수 있다"**는 철학. 아이템 식별, 저주와 축복, 예측 불가능한 결과들.
- **Slay the Spire**: **"시너지"**의 중요성. 각기 다른 카드(아이템/스킬)들이 조합되어 강력한 효과를 내는 덱 빌딩의 재미를 벤치마킹.
- **Zork**: 텍스트 기반 인터페이스가 주는 몰입감. 명령어 기반 상호작용의 좋은 예시입니다.

### 3. 핵심 디자인 철학 (Core Design Philosophy)

> 이 섹션은 "이 게임을 왜 재미있게 만드는가?"에 대한 답변입니다. 모든 기능은 아래 철학을 기반으로 설계됩니다.

- **철학 1: 모든 선택은 의미 있다 (Meaningful Choices)**
    - 캐릭터 생성부터 아이템 사용까지, 플레이어의 모든 선택은 명확한 장단점을 가져야 합니다. '최고의 선택'은 없으며, 오직 '자신의 전략에 맞는 선택'만이 존재합니다. 이를 통해 플레이어는 끊임없이 고민하고 자신만의 해법을 찾아야 합니다.

- **철학 2: '쓰레기'는 없다 (No 'Junk' Items)**
    - 모든 아이템은 그 자체로 고유한 역할과 상황적 가치를 가집니다. 단순 스탯 비교가 아닌, "이 아이템을 어떤 상황에서 어떻게 활용할 것인가?"를 고민하게 만드는 것이 목표입니다. 저주받은 아이템조차 역이용할 수 있는 가능성을 열어둡니다.

- **철학 3: 예측 불가능성이 만드는 서사 (Emergent Narrative)**
    - 정해진 스토리를 따라가는 것이 아니라, 시스템들의 상호작용을 통해 플레이어 자신만의 이야기가 만들어져야 합니다. '독 바른 단검으로 신에게 제물을 바쳤더니 신이 분노했다' 와 같은, 플레이어의 행동이 예측하지 못한 결과를 낳는 '창발적 서사'를 지향합니다.

### 4. 게임의 흐름 (Game Flow)

1.  **시작**: `/탐험시작` 명령어로 새로운 모험을 시작합니다. 플레이어는 **종족**(인간, 엘프, 드워프 등)과 **직업**(전사, 마법사, 도적 등)을 선택하며, 이에 따라 초기 능력치와 장비가 달라집니다. 던전은 매번 절차적으로 새롭게 생성됩니다.
2.  **탐험**: 플레이어는 `동`, `서`, `남`, `북` 등의 방향 버튼을 눌러 던전을 탐험합니다. 각 방에는 몬스터, 함정, 아이템 등이 무작위로 배치됩니다. **시야(Field of View)** 개념을 도입하여, 플레이어가 직접 본 지역만 미니맵에 표시됩니다.
3.  **전투**: 몬스터와 마주치면 턴제 전투가 시작됩니다. 플레이어는 `공격`, `마법 사용`, `아이템 사용`, `도망` 등 다양한 선택지를 버튼으로 제공받습니다. 전투 로그는 메시지 수정을 통해 실시간으로 업데이트됩니다.
4.  **성장**: 몬스터를 처치하여 경험치를 얻고 레벨업을 합니다. 레벨업 시 스탯을 직접 분배하고 새로운 스킬을 배울 수 있습니다. 던전에서 강력한 장비를 찾아 캐릭터를 강화하는 것이 핵심입니다.
5.  **죽음 (영구적)**: 캐릭터의 HP가 0이 되면 **사망**합니다. 해당 캐릭터의 모든 진행 상황(레벨, 아이템)은 **영구적으로 사라집니다.** `/전적` 명령어를 통해 과거 캐릭터들의 사망 원인, 도달한 깊이, 플레이 시간 등을 볼 수 있는 '묘비' 기능을 제공합니다.
6.  **승리 조건**: 던전 가장 깊은 곳에 있는 특정 유물(예: "옌더의 아뮬렛")을 획득하여 지상으로 무사히 귀환하면 승리합니다.

### 5. 핵심 시스템 상세 설계 (Core System Details)

#### 5.1. 캐릭터 빌드의 깊이: 특성과 시너지
- **디자인 의도**: 단순한 스탯 증감을 넘어, 종족과 직업의 조합이 플레이 스타일 자체를 바꾸도록 설계합니다.
- **구현 방식**:
    - **종족별 고유 특성 (Racial Traits)**: 모든 종족은 고유한 패시브 스킬과 액티브 스킬을 가집니다.
        - **인간**: `숙련도` (패시브) - 모든 행동에서 경험치를 10% 더 얻음. `격려` (액티브) - 다음 3턴간 모든 능력치 소폭 상승.
        - **엘프**: `마나 친화` (패시브) - 10턴마다 마나 1 회복. `원소 감응` (액티브) - 현재 층의 속성을 파악.
        - **드워프**: `강인함` (패시브) - 독, 질병 등 상태이상 저항력 +20%. `석화 피부` (액티브) - 3턴간 방어력 2배, 행동 불가.
    - **직업별 시작 스킬 및 장비**: 직업은 시작 아이템뿐만 아니라, 고유한 스킬을 제공하여 초반 플레이 방향을 결정합니다.
        - **전사**: `강타` 스킬 (마나를 소모해 다음 공격을 강화).
        - **마법사**: `매직 미사일` 스펠 (기본 원거리 공격 마법).
        - **도적**: `그림자 숨기` 스킬 (주변이 어두우면 은신하여 적에게 발견될 확률 감소).
    - **조합 시너지**: 특정 종족과 직업이 만나면 추가 보너스나 새로운 스킬이 해금될 수 있습니다. (예: `엘프 마법사`는 '마나 친화' 패시브가 '고대 마나 친화'로 강화되어 마나 회복량 증가)

#### 5.2. 살아있는 아이템: 능력과 상호작용
- **디자인 의도**: 아이템을 단순한 스탯 상승 도구가 아닌, 새로운 전략적 가능성을 여는 '도구'로 만듭니다.
- **구현 방식**:
    - **사용/장착 효과 (Active & Passive Effects)**: 모든 장비는 기본 스탯 외에 고유 능력을 가질 수 있습니다.
        - 예: `흡혈의 단검` (공격력 +2, 공격 성공 시 10% 확률로 HP 1 흡수), `화염 저항의 반지` (방어력 +1, 화염 데미지 50% 감소).
    - **조건부 능력**: 특정 조건에서만 강력해지는 아이템이 존재합니다.
        - 예: `거미 학살자` (공격력 +1, 거미 타입 적에게 공격력 +10).
    - **저주와 축복**: 아이템은 '저주받은', '축복받은', '평범한' 상태를 가집니다. 저주받은 아이템은 강력한 대신 탈착이 불가능하거나 패널티를 주며, 축복받은 아이템은 효과가 강화됩니다.
    - **재질과 속성**: 아이템의 '재질'(나무, 철, 은)이나 '속성'(불, 냉기)이 환경 및 몬스터와 상호작용합니다. (예: 나무 방패는 불 공격에 불타 없어질 수 있음).

#### 5.3. 석판: 공물과 계약
- **디자인 의도**: 플레이어가 던전에서 발견하는 '석판'과의 상호작용을 통해, 점진적으로 심화되는 선택지를 제공합니다. 초반에는 낮은 리스크로 작은 이득을 취하며 빌드의 방향성을 탐색하게 하고, 후반에는 플레이어가 감당할 수 있는 시점에 높은 리스크와 높은 보상을 동반한 '계약'을 선택할 기회를 줍니다. 이를 통해 자연스러운 난이도 곡선과 성장 경험을 제공하는 것이 목표입니다.

- **구현 방식: 2단계 상호작용**

    - **1단계: 공물 (Tribute Phase)**
        - **초기 상호작용**: '석판'을 처음 발견하면 `[공물을 바친다]` 선택지만 활성화됩니다.
        - **공물의 역할**: 플레이어는 아이템이나 골드를 공물로 바쳐, 해당 석판과의 `공헌도`를 쌓을 수 있습니다.
        - **보상 및 힌트**: 공물을 바칠 때마다, 플레이어는 해당 계약의 테마와 관련된 **일회성의 작은 보상**을 얻습니다. 이 보상은 그 자체로 계약의 성격에 대한 **자연스러운 힌트**가 됩니다.
            - 예: `피의 계약` 석판에 '단검'을 바치면 -> `다음 50턴간 적에게 입힌 피해의 5%를 체력으로 흡수합니다.` 라는 임시 버프 획득. 이를 통해 플레이어는 이 석판이 '공격'과 '흡혈'에 관련되어 있음을 유추할 수 있습니다.
        - **공헌도 누적**: 공물을 바칠 때마다 해당 석판에 대한 `공헌도`가 누적됩니다.

    - **2단계: 계약 (Covenant Phase)**
        - **계약의 해금**: `공헌도`가 일정 수치 이상 쌓이면, `[계약을 맺는다]` 선택지가 새롭게 활성화됩니다.
        - **플레이어의 선택**: 이제 플레이어는 계속해서 안전한 공물을 바칠지, 아니면 강력한 힘을 위해 위험한 계약을 맺을지 선택해야 합니다.
        - **계약의 내용**:
            - **조항 (Clauses)**: 모든 계약은 지켜야 할 '권장 조항'과 어겨서는 안 될 '금지 조항'을 가집니다.
            - **권능 (Powers)**: 권장 조항을 따르면 `공헌도`가 계속 쌓이며, 특정 수치를 넘을 때마다 강력한 패시브/액티브 능력인 `권능`이 해금됩니다.
            - **반발 (Backlash)**: 금지 조항을 어기면 `공헌도`가 크게 삭감되며, 일정 수치 이하로 떨어지면 계약의 힘이 뒤틀려 `반발`이라는 강력한 패널티를 받게 됩니다.

        - **계약의 예시**:
            - **1. 수집가의 계약**
                - **테마**: 탐욕, 소유, 부
                - **공물 힌트**: 골드나 보석을 공물로 바치면, `다음 100턴간 아이템 드랍률이 소폭 증가합니다.` 같은 버프를 받습니다.
                - **계약 내용**:
                    - **권장 조항**: 골드나 보석 아이템을 획득할 때마다.
                    - **금지 조항**: 상점에서 아이템을 구매하거나, 골드를 소모하는 함정을 발동시킬 때마다.
                    - **권능 (예시)**: 공헌도에 비례하여 상점 가격 할인, 아이템 자동 식별 확률, '탐욕의 손아귀'(주변 아이템을 끌어오는 스킬) 획득.
                    - **반발 (예시)**: 공헌도가 낮아지면, 획득하는 모든 골드에 '저주'가 걸려 일정 확률로 소멸합니다.

            - **2. 광전사의 맹세 (The Berserker's Oath)**
                - **테마**: 연속 전투
                - **공물 힌트**: 무기나 방어구를 공물로 바치면, `다음 3번의 전투에서 공격력이 10% 증가합니다.` 같은 버프를 받습니다.
                - **계약 내용**:
                    - **권장 조항**: 몬스터에게 3턴 이내에 피해를 입힐 때마다.
                    - **금지 조항**: 10턴 이상 전투 없이 보낼 때.
                    - **권능 (예시)**: 공헌도에 비례하여 잃은 체력만큼 공격력 증가, 피격 시 일정 확률로 반격, '광폭화'(일시적으로 공격 속도와 공격력을 대폭 상승시키는 스킬) 획득.
                    - **반발 (예시)**: 공헌도가 낮아지면, 플레이어는 '혼란' 상태에 빠져 아군/적군 구분 없이 공격할 확률이 생깁니다.

            - **3. 학자의 서약 (The Scholar's Vow)**
                - **테마**: 지식, 탐험, 발견
                - **공물 힌트**: 미확인 스크롤이나 포션을 공물로 바치면, `가방에 있는 무작위 아이템 1개를 식별합니다.` 같은 효과를 얻습니다.
                - **계약 내용**:
                    - **권장 조항**: 새로운 층에 도달하거나, 맵의 모든 타일을 밝히거나, 아이템을 식별할 때마다.
                    - **금지 조항**: 이미 식별된 스크롤이나 포션을 사용할 때. (새로운 지식 추구에 반하는 행위)
                    - **권능 (예시)**: 공헌도에 비례하여 스크롤 및 포션 효과 증폭, 숨겨진 문 발견 확률 증가, '지혜의 눈'(주변의 모든 함정과 적을 일시적으로 드러내는 스킬) 획득.
                    - **반발 (예시)**: 공헌도가 낮아지면, 스크롤을 읽을 때 '지식의 역류'가 발생하여 무작위 디버프에 걸릴 확률이 생깁니다.

#### 5.4. 계약의 압박 완화 장치
- **디자인 의도**: 계약의 지속적인 압박감으로 인해 플레이가 불쾌해지는 것을 방지하고, 플레이어에게 능동적으로 위기를 관리할 수 있는 전략적 수단을 제공합니다.
- **구현 방식**:
    - **소모성 아이템: `고요의 부적 (Talisman of Stillness)`**
        - **획득 방법**: 던전 탐험 중 매우 드물게 발견하거나, 특정 몬스터에게서 낮은 확률로 획득할 수 있는 희귀 소모품입니다.
        - **효과**: 이 부적을 사용하면, **정해진 턴(예: 100턴) 동안 현재 맺고 있는 계약의 모든 조항(권장/금지)이 일시적으로 정지되어, 공헌도가 고정됩니다.**
        - **전략적 가치**: 플레이어는 전투 후 재정비가 필요하거나, 까다로운 함정 지대를 통과해야 할 때, 혹은 금지 조항을 어길 수밖에 없는 상황에 처했을 때 이 부적을 사용하여 전략적으로 위기를 넘길 수 있습니다. 이는 "성소 찾기"라는 수동적 행운 대신, "부적 사용"이라는 능동적인 자원 관리의 재미를 제공합니다.

### 6. UI/UX 및 렌더링 상세

#### 6.1. 화면 구성 (Screen Layout)
- **디자인 의도**: 한정된 공간 안에서 게임의 모든 정보를 효율적으로 전달합니다. 플레이어는 하나의 메시지만 보고도 게임의 모든 상황을 파악할 수 있어야 합니다.
- **레이아웃**: 모든 게임 정보는 단일 디스코드 메시지(임베드) 안에서 실시간으로 업데이트됩니다.
    1.  **미니맵 (Viewport)**: 플레이어를 중심으로 한정된 범위(예: 21x11)의 맵을 보여주는 **'뷰포트'** 방식. ` ``` ` 코드 블록을 사용하여 텍스트가 깨지지 않는 고정폭 글꼴로 렌더링합니다.
    2.  **상태 바 (Status Bar)**: 플레이어의 현재 HP, MP, 레벨, 던전 층수 등 핵심 스탯을 표시합니다.
    3.  **메시지 로그 (Message Log)**: "플레이어가 고블린을 공격하여 5의 피해를 입혔습니다." 와 같이, 전투나 탐험 중 발생하는 모든 이벤트 로그를 순서대로 보여줍니다.
    4.  **행동 버튼 (Action Buttons)**: 8방향 이동 버튼, `관찰하기`, `줍기`, `계단 이용` 등 현재 상황에서 가능한 행동 버튼들을 제공합니다. 8방향 이동 버튼은 3x3 격자로 배치하여 조작 편의성을 확보합니다.

#### 6.2. 렌더링 및 상호작용 설계 (Rendering & Interaction Design)

##### 6.2.1. 뷰포트 렌더링 (Viewport Rendering)
- **설계 의도**: 사용자의 Discord 클라이언트 환경(창 크기, 폰트 설정)이나 메시지 글자 수 제한에 관계없이, 언제나 동일하고 안정적인 그래픽을 제공하는 것을 목표로 합니다.
- **구현 방식**:
    - 전체 맵을 한 번에 전송하는 대신, 플레이어를 중심으로 한 고정된 크기(예: 21x11)의 **뷰포트**만 잘라내어 렌더링합니다.
    - 이 뷰포트 텍스트는 항상 코드 블록(\`\`\`)으로 감싸, 고정폭 글꼴로 출력되게 함으로써 이모지/문자 간의 정렬이 어긋나지 않도록 보장합니다.
    - 이 방식은 전송 데이터 양을 최소화하여 Discord의 메시지 글자 수 제한(2000자) 문제를 원천적으로 방지합니다.

##### 6.2.2. 그래픽 요소: 100% 이모지 (Graphical Elements: 100% Emoji)
- **설계 의도**: 아스키 문자와 이모지를 혼용할 때 발생하는 문자 폭 차이로 인한 그리드 깨짐 현상을 방지하고, 다채로운 비주얼을 통해 게임의 시각적 매력을 극대화합니다.
- **구현 방식**:
    - 맵을 구성하는 모든 그래픽 요소를 이모지로 통일합니다.
    - **이모지 규칙 (예시)**:
        - **플레이어**: `🙂`
        - **몬스터**: `👺`(고블린), `🐍`(독사), `🐀`(쥐)
        - **아이템**: `💰`(골드), `🧪`(물약), `📜`(주문서)
        - **지형**: `🟩`(바닥), `🟫`(벽), `🔼`(윗계단), `🔽`(아랫계단), `🚪`(문)

##### 6.2.3. 시야 시스템의 시각적 표현 (Visual Representation of FoV)
- **설계 의도**: 색상 사용이 불가능한 텍스트 환경의 한계를 극복하고, '시야', '기억', '미탐험' 상태를 직관적으로 구분하여 플레이어에게 명확한 정보를 전달합니다.
- **구현 방식**:
    - 각 시야 상태를 각기 다른 테마의 이모지 셋(Set)으로 표현합니다.
        - **`시야 내 (Visible)`**: 현재 플레이어의 시야에 들어오는 영역. 모든 오브젝트(몬스터, 아이템, 지형)가 **생생한 컬러 이모지**로 표시됩니다. (`👺`, `💰`, `🟩`)
        - **`기억 속 (Memorized)`**: 이전에 방문했지만 현재는 보이지 않는 영역. 지형의 구조만 **단색 도형 이모지**로 표시됩니다. (`▫️` 바닥, `🔳` 벽). 아이템이나 몬스터는 표시되지 않아 오래된 정보임을 암시합니다.
        - **`탐험 전 (Unexplored)`**: 아직 한 번도 방문하지 않은 미지의 영역. 안개를 상징하는 `⚫` 이모지로 채워집니다.

##### 6.2.4. 행동과 상호작용 (Actions & Interactions)
- **설계 의도**: 단순 이동 외에 '관찰'과 '줍기' 같은 명확한 상호작용을 정의하여, 플레이어가 더 깊이 있고 신중하게 게임을 플레이하도록 유도합니다.

- **주요 행동 정의**:
    - **`이동 (Movement)`**:
        - **방향**: 대각선을 포함한 8방향 이동을 지원합니다. 이는 위치 선정, 적 공격 회피, 원거리 공격 각 확보 등 전투와 탐험의 핵심적인 전략 요소로 작용합니다.
        - **UI**: 8개의 이동 버튼은 3x3 격자 형태로 배치하여(예: 숫자 키패드 모양) 많은 버튼이 난잡해 보이지 않고 직관적으로 조작할 수 있게 합니다. 중앙 버튼은 `대기` 혹은 `아이템 사용` 등으로 활용될 수 있습니다.
            - **기술적 구현**: Discord API는 한 메시지에 최대 5개의 '줄(ActionRow)'을, 각 줄에 최대 5개의 버튼을 허용합니다. 따라서 3x3 격자 버튼은 3개의 줄에 각각 3개의 버튼을 배치하는 방식으로 충분히 구현 가능합니다.
        - **액션 처리 및 최적화 (Action Handling & Optimization)**:
            - **문제 인식**: 플레이어가 이동 버튼을 빠르게 연속으로 누를 경우, 각 입력이 개별 턴으로 처리되어야 하지만 Discord API의 업데이트 속도 제한 문제가 발생할 수 있습니다. '관찰'과 달리 이동은 모든 입력이 순서대로 반영되어야 하므로 '디바운싱' 기법은 부적합합니다.
            - **해결 방안 (입력 잠금)**: '디바운싱' 대신 **입력 잠금(Input Locking)** 메커니즘을 사용합니다.
                1. 플레이어가 이동 버튼을 누르면, 즉시 모든 행동 버튼을 '비활성화'하여 추가 입력을 막습니다.
                2. 봇이 해당 턴의 모든 로직(플레이어 이동, 몬스터 행동 등)을 처리합니다.
                3. 게임 상태 업데이트가 완료되고 Discord 메시지(화면)가 성공적으로 갱신되면, 버튼을 다시 '활성화'합니다.
                4. 이를 통해 모든 입력이 순차적으로 처리되면서도 API 호출을 제어하여 안정적인 플레이 경험을 제공합니다.

    - **`관찰하기 (Observe)`**:
        - **개념**: 위험을 감수하기 전에 주변을 정찰하는 능력입니다. 단순 '조사'를 넘어선 '정찰'의 개념입니다.
        - **작동 방식**:
            1. 플레이어가 `관찰하기` 버튼을 누르면 '관찰 모드'로 전환됩니다.
            2. 이동 버튼이 '관찰 커서 이동' 기능으로 일시적으로 변경됩니다.
            3. 플레이어는 자신의 시야(FoV) 내에서 커서를 자유롭게 움직여 원하는 타일을 선택합니다.
            4. 커서가 위치한 타일의 상세 정보(예: `[지형:돌 바닥], [함정:화살 함정]이 설치되어 있습니다.`, `[적:고블린 정찰병]이 경계하고 있습니다.`)가 메시지 로그에 표시됩니다.
            5. `관찰하기`를 다시 누르거나 `취소` 버튼을 선택하면 원래의 탐험 모드로 돌아옵니다.
        - **업데이트 최적화 (Update Optimization)**:
            - **문제 인식**: '관찰 모드'에서 커서를 이동할 때마다 메시지를 수정하면, Discord API의 속도 제한(Rate Limit)에 의해 요청이 누락되거나 지연될 수 있습니다.
            - **해결 방안 (디바운싱)**: 플레이어가 커서 이동 버튼을 누를 때마다 즉시 메시지를 갱신하지 않습니다. 대신, 마지막 조작 후 일정 시간(예: 0.5초) 동안 추가 입력이 없으면, 그 때 한 번만 최신 커서 위치의 정보로 메시지를 갱신합니다. 이를 통해 불필요한 API 호출을 최소화하고 안정적인 사용자 경험을 제공합니다.

    - **`아이템 줍기 (Pick Up)`**:
        - **개념**: 바닥에 있는 아이템을 줍는 행동입니다.
        - **작동 방식**:
            1. 플레이어가 아이템이 있는 타일로 이동하면 `줍기` 버튼이 활성화됩니다.
            2. `줍기` 버튼을 누르면, 해당 타일의 아이템 목록을 보여주는 '타일 상세 보기' UI가 나타납니다.
            3. 플레이어는 이 UI를 통해 원하는 아이템만 골라서 줍거나, `모두 줍기`를 할 수 있습니다.

##### 6.2.5. 타일 점유 규칙 (Tile Occupancy Rules)
- **설계 의도**: 게임 내 객체들의 공간 배치를 명확히 하여, '몬스터와 플레이어가 겹치는' 등의 논리적 오류를 방지하고 예측 가능한 게임 환경을 만듭니다.
- **구현 방식**:
    - 타일은 `지형(Terrain)` → `아이템(Items)` → `액터(Actor)` 순의 논리적 레이어 구조를 가집니다.
    - **핵심 규칙**: 하나의 타일에는 단 하나의 **액터(플레이어 또는 몬스터)**만 존재할 수 있습니다.
    - 이에 따라, 플레이어가 몬스터와 같은 타일에 위치하는 경우는 발생하지 않습니다. 단, 플레이어는 아이템이 쌓여 있는 타일로는 자유롭게 이동할 수 있으며, 해당 타일에서 `조사하기`를 통해 상호작용합니다.

*(기존의 5.5. 탐험과 상호작용, 5.6. 전투 시스템, 6. 게임 인터페이스 섹션은 이 새로운 섹션에 통합 및 재구성되었습니다.)*
# 디버깅, QA, 기능 테스트 가이드라인

이 문서는 "던전 앤 디스코드" 게임의 안정성과 품질을 보장하기 위한 테스트 절차와 가이드라인을 정의합니다. 모든 개발자는 새로운 기능을 추가하거나 수정할 때 이 가이드라인을 따라 테스트를 수행해야 합니다.

## 1. 첫 실행 및 초기 설정 테스트 (Initial Setup QA)

> **목표**: 봇을 처음 클론하거나 데이터베이스를 완전히 초기화한 후, 모든 시스템이 정상적으로 설정되었는지 확인합니다.

1.  **터미널 로그 확인**:
    - 봇을 실행했을 때, 터미널(콘솔)에 `데이터베이스 초기화` 관련 로그가 순서대로 출력되는지 확인합니다.
    - `❌` 표시가 포함된 오류 로그가 없는지 반드시 확인해야 합니다.
    - **정상 로그 순서 예시**:
        ```
        Bot is ready, starting database initialization...
        데이터베이스 초기화 시작...
        ✅ 기본 테이블 구조 생성 완료.
        데이터 업데이트 확인 시작...
        'races' 데이터 업데이트 적용: 버전 1 ...
        'classes' 데이터 업데이트 적용: 버전 1 ...
        (모든 v1 데이터 스크립트 적용 로그)
        ✅ 모든 데이터 업데이트 확인 및 적용 완료.
        ```

2.  **데이터베이스 직접 확인 (pgAdmin 등)**:
    - 데이터베이스에 `public` 스키마 아래로 `game_characters`, `game_items` 등 모든 `game_` 테이블이 생성되었는지 확인합니다.
    - `game_races`, `game_items` 등 마스터 데이터 테이블을 열어, `_v1.sql` 스크립트의 데이터가 정상적으로 삽입되었는지 확인합니다. (예: '인간', '엘프', '치료 물약' 등이 있는지)
    - `game_data_versions` 테이블을 열어, 모든 데이터 타입의 `version`이 `1`로 설정되었는지 확인합니다.

3.  **버전 확인 명령어 실행**:
    - 디스코드 채널에서 `/버전` 명령어를 실행합니다.
    - '코드 버전'과 '데이터 버전'이 모두 정상적으로 표시되는지, 특히 데이터 버전이 `v1`으로 잘 나오는지 확인합니다.

## 2. 핵심 기능 테스트 (Core Feature QA)

> **목표**: 게임의 핵심 플레이 사이클이 기획 문서대로 올바르게 작동하는지 검증합니다.

### `/탐험시작` (캐릭터 생성)
- **시나리오 1: 정상 생성**
    - [ ] `/탐험시작` 실행 시 "새로운 모험을 시작합니다." 메시지와 함께 '종족 선택' 드롭다운이 표시되는가?
    - [ ] '종족'을 선택하면, '직업 선택' 드롭다운이 추가로 나타나는가?
    - [ ] '직업'까지 선택하면, '캐릭터 생성' 버튼이 활성화되는가?
    - [ ] '캐릭터 생성' 버튼을 누르면, "캐릭터 생성이 완료되었습니다." 메시지와 함께 모든 UI가 비활성화되는가?
    - [ ] 뒤이어 "모험의 시작" 임베드(이름, 종족, 직업 포함)가 출력되는가?
- **시나리오 2: 예외 처리**
    - [ ] 이미 살아있는 캐릭터가 있을 때 다시 실행하면 "이미 살아있는 모험가가 있습니다." 라는 메시지가 출력되는가?
    - [ ] 다른 사람이 실행한 `/탐험시작` UI를 조작하려고 하면 "명령어를 실행한 본인만 선택할 수 있습니다." 라는 메시지가 출력되는가?
    - [ ] 300초(5분) 동안 아무 조작도 하지 않으면 "캐릭터 생성 시간이 초과되었습니다." 메시지와 함께 UI가 비활성화되는가?
- **시나리오 3: DB 검증**
    - [ ] `game_characters` 테이블에 새로운 캐릭터 정보가 `user_id`와 함께 정확히 저장되는가? (이름, 종족/직업 ID, 기본 스탯, `next_exp=100` 등)
    - [ ] `game_inventory` 테이블에 선택한 직업의 시작 아이템들이 올바른 `character_id`와 연결되어 저장되는가?

### `/내정보` (캐릭터 조회)
- **시나리오 1: 정상 조회**
    - [ ] `/탐험시작`으로 캐릭터를 생성한 후, `/내정보`를 실행하면 캐릭터 정보 임베드가 올바르게 표시되는가?
    - [ ] **임베드 필드 검증**:
        - [ ] 제목이 `<캐릭터이름>의 모험 정보` 형식인가?
        - [ ] 설명이 `_종족이름 직업이름_` 형식인가?
        - [ ] 레벨, 경험치, HP, MP, 공격력, 방어력이 DB의 `game_characters` 테이블 값과 일치하는가?
        - [ ] '장착 장비' 필드에 장착된 아이템 이름이 표시되는가? (초기에는 비어 있어야 정상)
        - [ ] '가방' 필드에 시작 아이템들이 수량과 함께 잘 표시되는가? (예: `녹슨 장검 (1)`)
- **시나리오 2: 예외 처리**
    - [ ] 캐릭터가 없는 상태에서 실행하면 "생성된 캐릭터가 없습니다." 라는 안내 메시지가 표시되는가?

## 3. 데이터 업데이트 테스트 (Data Update QA)

> **목표**: 데이터 버전 관리 시스템이 새로운 데이터 스크립트를 올바르게 감지하고 실행하는지 검증합니다.

1.  **테스트용 SQL 파일 생성**: `sql/updates/` 폴더에 테스트용 파일을 만듭니다. (예: `items_v2.sql`)
    ```sql
    -- items_v2.sql
    INSERT INTO game_items (name, ...) VALUES ('강철 방패', ...);
    ```
2.  **버전 상수 수정**: `cogs/database.py`의 `check_and_apply_updates` 로직은 파일 이름(`_v2.sql`)을 파싱하므로, 더 이상 코드 내 상수를 수정할 필요가 없습니다. 이 단계는 건너뜁니다.
3.  **봇 재시작 및 로그 확인**: 봇을 재시작하고, 터미널 로그에 `'items' 데이터 업데이트 적용: 버전 2` 라는 로그가 출력되는지 확인합니다.
4.  **DB 및 게임 내 확인**:
    - `game_items` 테이블에 '강철 방패'가 추가되었는지 확인합니다.
    - `game_data_versions` 테이블에서 `items`의 `version`이 `2`로 업데이트되었는지 확인합니다.
    - `/버전` 명령어를 실행하여 데이터 버전이 `items: v2`로 표시되는지 확인합니다.
5.  **테스트 파일 삭제**: 확인 후 테스트용으로 만든 `items_v2.sql` 파일은 삭제합니다.

## 4. 개발자 디버깅 도구 활용

-   `/db구조`: 데이터베이스의 모든 테이블 이름과 각 테이블의 컬럼 구조가 예상대로인지 빠르게 확인할 때 사용합니다.
-   `/db조회 [table_name]`: 특정 테이블의 실제 데이터 내용을 디스코드를 통해 직접 확인할 때 사용합니다. 기능 테스트 후 DB 값이 올바르게 변경되었는지 검증할 때 유용합니다.
-   `/db실행 [filename]`: 개발 중 긴급하게, 또는 일회성으로 SQL 스크립트를 수동 실행해야 할 때 사용합니다. (단, 자동 업데이트 프로세스를 우회하므로 주의해서 사용해야 합니다.) 